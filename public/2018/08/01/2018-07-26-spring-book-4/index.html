<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="WanBlog | 개발블로그">
    <meta name="keyword"  content="WanBlog | 개발블로그">
    <meta name="naver-site-verification" content="c80ae88a487472e88ec9170ad53578e81edad8b1"/>

    <meta property="og:type" content="article">
	  <meta property="og:title" content="Wan Blog">
	  <meta property="og:url" content="https://minwan1.github.io/img/ironman-draw.png">
	  <meta property="og:site_name" content="JavaScript/Java/Spring 개발 Blog">
	  <meta property="og:description" content="WanBlog | 개발블로그">
	  <meta property="og:image" content="https://minwan1.github.io/img/ironman-draw.png">
	  <meta property="og:updated_time" content="2017-11-26T10:28:42.000Z">
    
    <link rel="shortcut icon" href="/img/ironman-draw.png">
    <!-- Place this tag in your head or just before your close body tag. -->
    <script async defer src="https://buttons.github.io/buttons.js"></script>
    <title>
        
          온라인 서점 API 만들기로 살펴보는 Spring Boot OOP 4 - WanBlog | 개발블로그
        
    </title>

    <link rel="canonical" href="https://minwan1.github.io/2018/08/01/2018-07-26-spring-book-4/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/beantech.min.css">

    <!-- Pygments Highlight CSS -->
    <link rel="stylesheet" href="/css/highlight.css">

    <link rel="stylesheet" href="/css/widget.css">

    <link rel="stylesheet" href="/css/rocket.css">

    <link rel="stylesheet" href="/css/signature.css">

    <link rel="stylesheet" href="/css/toc.css">

    <!-- Custom Fonts -->
    <!-- <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
    <!-- Hux change font-awesome CDN to qiniu -->
    <link href="https://cdn.staticfile.org/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">


    <!-- Hux Delete, sad but pending in China
    <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/
    css'>
    -->


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- ga & ba script hoook -->
    <script></script>
</head>


<!-- hack iOS CSS :active style -->
<body ontouchstart="">
	<!-- Modified by Yu-Hsuan Yen -->
<!-- Post Header -->
<style type="text/css">
    header.intro-header{
        
            background-image: url('null')
            /*post*/
        
    }
    
    #signature{
        background-image: url('/img/signature/BeanTechSign-white.png');
    }
    
</style>

<header class="intro-header" >
    <!-- Signature -->
    <div id="signature">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                
                    <div class="post-heading">
                        <div class="tags">
                            
                              <a class="tag" href="/tags/#Spring" title="Spring">Spring</a>
                            
                              <a class="tag" href="/tags/#Java" title="Java">Java</a>
                            
                              <a class="tag" href="/tags/#온라인 서점 API 만들기로 살펴보는 Spring Boot OOP" title="온라인 서점 API 만들기로 살펴보는 Spring Boot OOP">온라인 서점 API 만들기로 살펴보는 Spring Boot OOP</a>
                            
                        </div>
                        <h1>온라인 서점 API 만들기로 살펴보는 Spring Boot OOP 4</h1>
                        <h2 class="subheading">회원가입 Service 만들기 - 응용영역 효율적으로 관리하기 (Part1)</h2>
                        <span class="meta">
                            Posted by Wan on
                            2018-08-01
                        </span>
                    </div>
                


                </div>
            </div>
        </div>
    </div>
</header>

	
    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Wan Blog</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <!-- Known Issue, found by Hux:
            <nav>'s height woule be hold on by its content.
            so, when navbar scale out, the <nav> will cover tags.
            also mask any touch event of tags, unfortunately.
        -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>

                    

                        
                    

                        
                        <li>
                            <a href="/about/">About</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/archive/">Archives</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/tags/">Tags</a>
                        </li>
                        
                    
                    
                </ul>
            </div>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>
<script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        // CLOSE
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        // OPEN
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>


    <!-- Main Content -->
    <!-- Modify by Yu-Hsuan Yen -->

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

            <!-- Post Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                <h1><span id="step-04-회원가입-service-만들기-응용영역-효율적으로-관리하기-part1">Step-04 회원가입 Service 만들기 : 응용영역 효율적으로 관리하기 - Part1</span></h1>
<h1><span id="응용-영역서비스">응용 영역(서비스)</span></h1>
<p>이 단계에서는 회원가입 기능을 구현하면서 <code>응용 영역</code>을 어떻게 하면 응집력 있고, 변경에 유연한 코드를 작성할지에 대해 알아볼 것입니다. 크게 아래와 같은 주제로 <code>응용영역</code>을 효율적으로 관리하는 방법에 대해 알아보겠습니다. (<strong>소프트웨어에서 변경이 유연하고, 확장가능한 코드는 아주 핵심적인 부분입니다.</strong>)</p>
<ul>
<li>서비스크기</li>
<li>요구사항 정리 및 초난감 회원가입 Service 구현</li>
<li>캡슐화</li>
</ul>
<h1><span id="1-서비스크기">1. 서비스크기</span></h1>
<p>드디어 회원가입을 하기 위한 signUp 서비스를 구현할 차례입니다. 먼저 회원가입 서비스 기능을 구현하기 전에 회원가입 서비스를 어느 정도의 서비스 크기로 가져갈지 생각해야합니다.</p>
<h2><span id="도메인의-모든-기능을-한클래스에서-구현하는-방법">도메인의 모든 기능을 한클래스에서 구현하는 방법</span></h2>
<p>먼저 책이나 일반적으로 많이 사용하는 방법인 도메인의 모든 기능을 한 클래스에 서비스에서 구현하는 방법이 있습니다.</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// MemberService.Class</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> MemberRepository memberRepository;</span><br><span class="line"><span class="comment">// 유저에관한 부가적인 기능을 만들기위한 수 많은 의존성 주입들</span></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> Member <span class="title">signUp</span><span class="params">(<span class="keyword">final</span> MemberSignupRequest request)</span></span>&#123; <span class="comment">// 회원가입을 위한 member정보</span></span><br><span class="line">    <span class="comment">//비지니스로직</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 유저에 관한 기능들</span></span><br></pre></td></tr></table></figure>
<p><strong>장점</strong> :</p>
<ul>
<li>하나의 클래스에 도메인과 관련된 모든 기능들이 모여 있다.</li>
<li>1인터페이스, 1구현체로 가져가게 되면 모든 Member의 기능들이 인터페이스에 명세되는 장점 있을 수 있다.</li>
</ul>
<p><strong>단점</strong> :</p>
<ul>
<li>한 클래스에 너무 많은 기능들이 모여있어, Member 관한 모든 private 함수들이 뒤섞여 소스 분석이 힘들다.</li>
<li>관련 없는 너무 많은 의존성들이 하나에 클래스에 주입된다.</li>
<li>한 클래스 모든 테스트코드를 작성해야 하기 때문에 테스트 코드를 관리하기 힘들다.</li>
<li>결국 추상화되기 위해서는 특정 기능의 서비스로 분리될 수밖에 없다.</li>
<li>SOLID 원칙을 준수하기 위해서는 결국 메서드를 분리해낼 수밖에 없다.(이 부분은 후에 좀 더 세부적으로 설명하겠습니다.)</li>
</ul>
<h2><span id="구분되는-기능별로-서비스-클래스를-구현하는방법">구분되는 기능별로 서비스 클래스를 구현하는방법</span></h2>
<p>그리고 다른 방법은 유저 도메인의 구분되는 기능별로 서비스 클래스를 구현하는 방법이 있습니다.</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span> <span class="comment">// 어노테이션을 붙이면 스프링에서 ComponentScan을 통해서 스프링 컨테이너에 자동으로 빈을등록해줌.</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span> <span class="comment">// 모든 필드 변수에 대해 생성자를 만들어줌으로 모든멤버필드에 스프링 빈이 주입이 되어진다.</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MemberSignUpService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//회원가입에 필요한 의존성만 주입됨</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> MemberRepository memberRepository;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> MemberHelperService memberHelperService;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Member <span class="title">signUp</span><span class="params">(<span class="keyword">final</span> MemberSignupRequest request)</span></span>&#123;</span><br><span class="line">        <span class="comment">//회원가입 로직</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">`</span><br></pre></td></tr></table></figure>
<p><strong>장점</strong> :</p>
<ul>
<li>유지 보수를 할 때 구분되는 기능별로 클래스가 나누어져 있기 때문에 해당 비즈니스로직에만 신경 쓸 수 있다.</li>
<li>해당 기능에 맞는 필요한 의존성만 주입할 수 있다.</li>
<li>테스트 코드 작성하기가 쉽다.</li>
<li>해당 기능을 추상화하려고 해도 이미 하나의 타입으로 뽑아져있기 때문에 추상화하기가 쉽다.</li>
</ul>
<p><strong>단점</strong> :</p>
<ul>
<li>클래스가 많아진다.(단점일까… 처음엔 단점이라고 생각했는데 요즘들어 그렇게 단점은 아니라고 생각합니다.)</li>
</ul>
<h3><span id="구분되는-기능별로-서비스-클래스를-구현하는방법-선택-이유">구분되는 기능별로 서비스 클래스를 구현하는방법 선택 이유</span></h3>
<p>아래와 같은 이유로 <code>도메인의 모든 기능을 한 클래스 서비스</code>에서 구현하는 방법이 가지는 단점 때문에 <code>구분되는 기능별로 서비스</code> 클래스를 구현하는 방법을 선택해서 구현할 것입니다.</p>
<ol>
<li><strong>테스트코드들을 구분하기 어려워진다.</strong></li>
</ol>
<p>한 클래스에 너무 많은 기능들이 있기 때문에 이것을 한 클래스에 테스트 코드를 작성하게 되면 테스트를 구분하기가 어려워집니다. 물론 테스트 클래스만 여러 개로 나눌 수 있지만 이 또한 어떤 테스트 클래스에 어떤 테스트가 작성되었는지 찾기가 어렵습니다.<br>
만약 <code>구분되는 기능별로 서비스 클래스를 구현하는 방법</code>으로 작성했다면 테스트 코드 또한 기능별로 나누어져 있기 때문에 쉽게 테스트 코드를 찾고 관리할 수 있습니다.</p>
<ol start="2">
<li><strong>너무 많은 public 함수들과 private 함수들이 뒤엉켜 소스분석하기가 어렵고, 한클래스에 너무많은 의존성 주입이 된다.</strong></li>
</ol>
<p>너무 많은 public 함수들과 private 함수들이 뒤엉켜 소스 분석하기가 어려워집니다. 만약 <code>구분되는 기능별로 서비스 클래스를 구현하는 방법</code>으로 구현한다면 public 함수 그리고 private 함수가 모두 해당 기능에 관련 있는 함수들입니다. 뿐만 아니라 한 클래스에 너무 많은 의존성 주입이 되는 것을 막을 수 있습니다.</p>
<ol start="3">
<li><strong>결국 추상화되어지기 위해서는 특정 기능의 서비스로 분리될수밖에 없다.</strong></li>
</ol>
<p>예를 들어 회원 패스워드 변경 기능, admin에 의한 패스워드 변경 기능이 있다고 해보겠습니다. 좀 더 자세히 설명하면 회원이 패스워드를 변경하기 위해서는 자신의 패스워드를 인증해야 하고 Admin은 별다른 인증 없이 회원의 패스워드를 변경할 수 있습니다. 물론 if 문으로 어드민인지 확인하고 처리할 수 있지만 계속해서 다른 역할들이 추가 될 수 있습니다. 그렇게 되면 패스워드 변경을 추상화해서 관리하는 것이 효율적일 것입니다.</p>
<p>하지만 여기에서 MemberService 자체를 추상화시키면 패스워드 변경을 제외한 나머지 기능들은 추상화가 되지 않을 것입니다. 이것은 ISP 위반입니다.(ISP에 대해서 나중에 좀 더 자세히 알아보겠습니다.) 결국 패스워드 변경을 추상화하기 위해 <code>도메인의 모든 기능을 한 클래스</code>에서 구현하는 방법의 MemberService.class에서 분리해서 별도의 클래스로 분리하고 인터페이스를 만들어야 합니다. 반면 <code>구분되는 기능별로 서비스 클래스</code>를 구현하는 방법 기능은 이미 클래스로 분리돼 있기 때문에 쉽게 유저 패스워드 변경이라는 인터페이스에 녹아들 수 있습니다.</p>
<h1><span id="2-요구사항-정리-및-초난감-회원가입-service-구현">2. 요구사항 정리 및 초난감 회원가입 Service 구현</span></h1>
<h2><span id="요구사항-정리의-필요성">요구사항 정리의 필요성</span></h2>
<p>서비스 영역을 구현할 때 중요한 것은 요구 사항을 받고 요구 사항을 정리하는 것입니다. 요구 사항이 간단해 보여도 정리해야 하는데 그 이유는 아래와 같습니다.</p>
<ul>
<li>간단한 작업 같지만 간단하지 않을 수 있습니다. 막상 요구 사항을 정리하다 보면 생각했던 것보다 작업량이 많을 수 있고 또 미쳐 생각하지 못한 곳에 영향을 주는 작업일 수 있기 때문입니다.</li>
<li>간단하다고 생각하고 정리하지 않고 바로 개발을 하게 되면 놓치는 부분이 발생합니다.</li>
<li>객체의 책임들을 나눌 수 있는 좋은 명세가 될 수 있습니다.</li>
</ul>
<p>다음은 회원가입 기능을 구현하기 위한 요구 사항입니다.(실제 구현에서는 모바일 인증코드는 없을 예정입니다. 몇 가지 예제를 설명하기 위해 예제에만 넣었습니다.)</p>
<p><strong>회원가입 요구사항</strong></p>
<ol>
<li>유저를 가입시키는 기능을 구현한다.</li>
<li>가입을 하려면 모바일 인증을 해야 한다.</li>
<li>중복된 이메일은 회원을 가입할 수 없다.</li>
</ol>
<h2><span id="초난감-회원가입-서비스-구현">초난감 회원가입 서비스 구현</span></h2>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MemberSignUpService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> MemberRepository memberRepository;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> CodeVerificationService codeVerificationService;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Member <span class="title">signUp</span><span class="params">(<span class="keyword">final</span> MemberSignupRequest request)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> Member duplicator = memberRepository.findByEmail(email);</span><br><span class="line">        <span class="keyword">if</span>(duplicator != <span class="keyword">null</span>) <span class="keyword">throw</span> <span class="keyword">new</span> MemberDuplicationException();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> CodeVerification codeVerification = codeVerificationService.findByMobile(request.getMobile()); <span class="comment">// 유저가 있는지 여부를 확인할 수 있는데 인증코드 정보 객체</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(codeVerification.getAuthCode().equals(request.getAuthCode)))&#123;</span><br><span class="line">            Member member = request.toMember();<span class="comment">//성공</span></span><br><span class="line">            memberRepository.save(member);</span><br><span class="line">            <span class="keyword">return</span> member;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> MobileAuthenticationCodeFaildException();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>위 소스의 흐름은 이렇습니다.</p>
<ol>
<li>먼저 이메일이 중복되었는지 Email로 멤버를 조회하여 멤버의 존재 여부를 확인합니다.</li>
<li>유저가 모바일 인증한 정보의 객체를 가져옵니다.</li>
<li>유저의 모바일 정보가 인증되었는지 확인을 합니다.</li>
<li>성공했다면 회원가입을 시킵니다.</li>
</ol>
<p>다음 소스는 회원가입 기능을 하는 데는 문제가 없는 소스입니다. 하지만 코드의 가독성도 떨어지고, 응집력이 떨어지고, 변경에 아주 취약한 소스입니다. 그 이유는 클래스의 역할 분담이 제대로 되지 않았고, 객체의 캡슐화가 되지 않았기 때문입니다.</p>
<p>여기에서 말하는 역할 분담은 책임을 의미합니다. 책임을 알아보기 전에 먼저 캡슐화에 대해 알아보겠습니다.</p>
<h1><span id="3-캡슐화">3. 캡슐화</span></h1>
<p>객체지향은 기본적으로 캡슐화를 통해 한 곳의 변화가 다른 곳에 미치는 영향을 최소화하여 변경의 유연함을 가질 수 있게 합니다. 캡슐화를 통해 응용영역을 좀 더 변경에 유연하게 만들 수 있습니다.</p>
<blockquote>
<ul>
<li>캡슐화는 객체가 내부적으로 기능을 어떻게 구현하는지를 감추는것이다. 이를 통해 내부적 변경의 유연함을 주고 코드의 응집력을 높여주는 기법이다.</li>
</ul>
</blockquote>
<h3><span id="회원가입-예제코드의-문제점">회원가입 예제코드의 문제점</span></h3>
<p>캡슐화가 안되어있다는 게 무슨 말인지 먼저 알아보겠습니다. 예를 들어 패스워드 변경 기능을 위해서는 codeVerificationService에 의존하고 뿐만 아니라 다른 곳곳에서도 codeVerificationService를 사용하고 있다고 해보겠습니다. 그런데 회사 보안 정책 강화로 인증코드를 체크할 때 만료시간 체크 기능을 추가하라는 요구 사항이 들어왔습니다.</p>
<p>이렇게 되면 애플리케이션 전체에 모바일 인증을 하는 소스를 아래와 같이 인증코드 체크, 만료 여부 체크 기능을 할 수 있는 로직으로 변경해야 합니다.</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//PasswordChangeService</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">changePassword</span><span class="params">(<span class="keyword">final</span> String mobile, <span class="keyword">final</span> String authCode, <span class="keyword">final</span> String password)</span></span>&#123;</span><br><span class="line">    CodeVerification CodeVerification = codeVerificationService.findByMobile(mobile);</span><br><span class="line">    <span class="keyword">if</span>(codeVerification.getAuthenticationCode.eqauls(authCode) &amp;&amp; codeVerification.getExpireDate() &lt; 현재시간)&#123;</span><br><span class="line">        <span class="comment">//성공</span></span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="comment">//실패</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>만약 한 곳이라도 실수로 변경하지 않는다면 버그로 이어지게 됩니다. 운 좋게 버그 없이 이 문제를 해결하였다고 생각해보겠습니다. 그런데 갑자기 회사에서 사용자 UX를 생각해서 만료 체크 기능을 없애고 다시 원래 로직으로 변경하라는 요구를 했습니다. 이렇게 되면 다시 전방위로 소스를 수정해야 합니다. 문제는 그 사이에 모바일 인증코드가 다른 곳에 더 추가돼 있을 수 있습니다. 이렇게 되면 소스를 변경하는 과정에서 더욱더 버그가 날 확률이 커집니다. 단지 인증코드 정책 하나가 변경하는것인데 엄청난 리소스가 필요하고 전방위적으로 버그 리스크를 가져야합니다.</p>
<p>이러한 문제는 getter에 오용과 데이터 중심적인 사고로 인해 발생하는 문제입니다. 만약 좀 더 객체지향적인 프로그래밍을 생각했었으면 이러한 문제를 만들지 않고 CodeVerification 객체 자체에 인증처리에 관한 캡슐화된 기능을 제공했었을 것입니다.</p>
<h2><span id="codeverification-객체-캡슐화하기">CodeVerification 객체 캡슐화하기</span></h2>
<p>위에 각각의 서비스들에서 최종적으로 하고 싶은 것은 CodeVerification 객체를 통해 인증코드가 인증될 수 있는 인증코드인지 확인하는 것입니다. 내부적인 로직은 알 필요가 없습니다. 이 내용을 바탕으로 CodeVerification 객체에 verify라는 캡슐화된 메서드를 추가할 것입니다.</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CodeVerification</span></span>&#123;</span><br><span class="line">    ... <span class="comment">//인증객체 다른 변수</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Timestamp expireDate;</span><br><span class="line">    <span class="keyword">private</span> String authCode; <span class="comment">// 어떤시스템으로부터발급되어진 인증코드</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">isExpired</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//expire check logic</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">isValidAuthCode</span><span class="params">(<span class="keyword">final</span> String authCode)</span></span>&#123;</span><br><span class="line">      <span class="comment">//auth code check logic</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">verify</span><span class="params">(<span class="keyword">final</span> String authCode)</span></span>&#123; <span class="comment">// 클라언트로부터 입력될수있는 인증코드</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 인증코드가 만료되거나 인증코드가 맞지않으면 Exception</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>이제 모든 서비스 영역들은 더 이상 모바일 인증 정책에 대해 알 필요 없이 CodeVerification에 캡슐화된 verify() 함수만 사용하면 됩니다. 예를 들어 위에서 작성한 패스워드 변경 서비스는 아래와 같이 사용할 수 있을 것입니다.</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//PasswordChangeService</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">changePassword</span><span class="params">(<span class="keyword">final</span> PasswordChangeRequest request)</span></span>&#123;</span><br><span class="line">    CodeVerification CodeVerification = codeVerificationService.findByMobile(request.getMobile());</span><br><span class="line">    codeVerification.verify(request.getAuthCode);</span><br><span class="line">    <span class="comment">//패스워드 변경로직</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>이제 회사에서 인증 코드에 정책이 변경된다고 해도 쉽게 그 변경에 대응할 수 있습니다. CodeVerification 객체에서만 캡슐화된 verify() 로직을 변경하면 되기 때문입니다. 객체의 캡슐화를 통해 코드의 응집력을 높이고 변경에 유연한 코드를 얻게 되었습니다.</p>
<h2><span id="tell-dont-ask">Tell, don’t ask</span></h2>
<p><code>Tell, don't ask</code>는 객체지향 및 캡슐화를 잘 표현하는 문장 같습니다. 응용영역에서 특별한 경우를 제외하고는 객체한테 묻지 말고 시키는 것이 코드의 응집력을 높입니다. 그렇지 않으면 위와 같이 변경하기 어려운 코드가 만들어지기 때문입니다.</p>
<p>위의 <code>초난감 회원가입 서비스</code> 같은 문제를 만들지 않기 위해 항상 비즈니스로 직을 작성하면서 getter를 오용하여 데이터 중심적인 비즈니스 로직을 작성하고 있는지를 의심해봐야 합니다.</p>
<p>또한 객체지향적인 프로그래밍을 하기 위해서 항상 자신이 객체한테 묻고 있는지, 시키고 있는지를 생각하면서 개발해야 합니다. 그래야 좀 더 객체지향적 프로그래밍을 할 수 있기 때문입니다. (물론 비즈니스 로직이 엄청 커지거나, 공통으로 처리되지 않는 로직으로 인한 서비스 로직에서 비즈니 스로직을 작성해야 할 때도 있습니다.)</p>
<h1><span id="마치며">마치며</span></h1>
<p>이장에서 응용 영역을 효율적으로 관리하기 위해 <code>구분되는 기능별로 클래스</code>를 구현하는 방법을 선택하여 <code>초난감 회원가입서비스</code>를 구현했습니다. 하지만 완성된 <code>초난감 회원가입 서비스</code>는 변경에 취약하고 응집력이 떨어지는 코드였습니다. 이렇게 변경에 취약한 이유는 많은 이유가 있겠지만 가장 기본적인 캡슐화가 되어 있지 않았습니다. 캡슐화를 통해 코드의 응집력을 높이고 변경에 유연한 코드로 변경하는 작업을 했습니다.</p>
<p>하지만 <code>초난감 회원가입 서비스</code>는 캡슐화의 문제도 문제이지만 기능의 역할 분담이 제대로 되지 않은 문제가 더 큽니다. 이 말은 책임이 적절하게 분리되지 않았다는 것을 의미합니다. 이러한 문제는 다음 part에서 좀 더 세부적으로 알아보겠습니다.</p>

                

                <hr>
                <!-- Pager -->
                <ul class="pager">
                    
                        <li class="previous">
                            <a href="/2018/08/01/2018-07-26-spring-book-5/" data-toggle="tooltip" data-placement="top" title="온라인 서점 API 만들기로 살펴보는 Spring Boot OOP 5">&larr; Previous Post</a>
                        </li>
                    
                    
                        <li class="next">
                            <a href="/2018/07/26/2018-07-26-intellij/" data-toggle="tooltip" data-placement="top" title="Intellij로 효율적으로 개발하기(1) - Intellij Refactoring 기능">Next Post &rarr;</a>
                        </li>
                    
                </ul>

                <!-- duoshuo Share start -->
                
                <!-- 多说 Share end-->

                <!-- 多说评论框 start -->
                
                <!-- 多说评论框 end -->

                <!-- disqus comment start -->
                
                    <div class="comment">
                        <div id="disqus_thread" class="disqus-thread"></div>
                    </div>
                
                <!-- disqus comment end -->
            </div>
            
            <!-- Tabe of Content -->
            <!-- Table of Contents -->

    
      <aside id="sidebar">
        <div id="toc" class="toc-article">
        <strong class="toc-title">Contents</strong>
        
          <ol class="toc-nav"><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">1.</span> <span class="toc-nav-text">Step-04 회원가입 Service 만들기 : 응용영역 효율적으로 관리하기 - Part1</span></a></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">2.</span> <span class="toc-nav-text">응용 영역(서비스)</span></a></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">3.</span> <span class="toc-nav-text">1. 서비스크기</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">3.1.</span> <span class="toc-nav-text">도메인의 모든 기능을 한클래스에서 구현하는 방법</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">3.2.</span> <span class="toc-nav-text">구분되는 기능별로 서비스 클래스를 구현하는방법</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">3.2.1.</span> <span class="toc-nav-text">구분되는 기능별로 서비스 클래스를 구현하는방법 선택 이유</span></a></li></ol></li></ol></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">4.</span> <span class="toc-nav-text">2. 요구사항 정리 및 초난감 회원가입 Service 구현</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">4.1.</span> <span class="toc-nav-text">요구사항 정리의 필요성</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">4.2.</span> <span class="toc-nav-text">초난감 회원가입 서비스 구현</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">5.</span> <span class="toc-nav-text">3. 캡슐화</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">5.0.1.</span> <span class="toc-nav-text">회원가입 예제코드의 문제점</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">5.1.</span> <span class="toc-nav-text">CodeVerification 객체 캡슐화하기</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">5.2.</span> <span class="toc-nav-text">Tell, don’t ask</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">6.</span> <span class="toc-nav-text">마치며</span></a></li></ol>
        
        </div>
      </aside>
    

                
            <!-- Sidebar Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                
                <section>
                    <!-- no hr -->
                    <h5><a href="/tags/">FEATURED TAGS</a></h5>
                    <div class="tags">
                       
                          <a class="tag" href="/tags/#Spring" title="Spring">Spring</a>
                        
                          <a class="tag" href="/tags/#Java" title="Java">Java</a>
                        
                          <a class="tag" href="/tags/#온라인 서점 API 만들기로 살펴보는 Spring Boot OOP" title="온라인 서점 API 만들기로 살펴보는 Spring Boot OOP">온라인 서점 API 만들기로 살펴보는 Spring Boot OOP</a>
                        
                    </div>
                </section>
                

                <!-- Friends Blog -->
                
                <hr>
                <h5>FRIENDS</h5>
                <ul class="list-inline">

                    
                </ul>
                
            </div>
        </div>
    </div>
</article>




<!-- disqus embedded js code start (one page only need to embed once) -->
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = "https-minwan1-github-io";
    var disqus_identifier = "https://minwan1.github.io/2018/08/01/2018-07-26-spring-book-4/";
    var disqus_url = "https://minwan1.github.io/2018/08/01/2018-07-26-spring-book-4/";

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<!-- disqus embedded js code start end -->




<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>
<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<script>
    async("https://cdn.bootcss.com/anchor-js/1.1.1/anchor.min.js",function(){
        anchors.options = {
          visible: 'hover',
          placement: 'left',
          icon: 'ℬ'
        };
        anchors.add().remove('.intro-header h1').remove('.subheading').remove('.sidebar-container h5');
    })
</script>
<style>
    /* place left on bigger screen */
    @media all and (min-width: 800px) {
        .anchorjs-link{
            position: absolute;
            left: -0.75em;
            font-size: 1.1em;
            margin-top : -0.1em;
        }
    }
</style>



    <!-- Footer -->
    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                
                
                

                

                

                
                    <li>
                        <a target="_blank"  href="https://github.com/Minwan1">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                

                </ul>
                <p class="copyright text-muted">
                    Copyright &copy; Wan 2019 
                    <br>
                    Theme by <a href="http://huangxuan.me">Hux</a> 
                    <span style="display: inline-block; margin: 0 5px;">
                        <i class="fa fa-heart"></i>
                    </span> 
                    re-Ported by <a href="http://beantech.org">BeanTech</a> | 
                    <iframe
                        style="margin-left: 2px; margin-bottom:-5px;"
                        frameborder="0" scrolling="0" width="91px" height="20px"
                        src="https://ghbtns.com/github-btn.html?user=YenYuHsuan&repo=hexo-theme-beantech&type=star&count=true" >
                    </iframe>
                </p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js"></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js"></script>

<!-- Custom Theme JavaScript -->
<script src="/js/hux-blog.min.js"></script>


<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>

<!-- 
     Because of the native support for backtick-style fenced code blocks 
     right within the Markdown is landed in Github Pages, 
     From V1.6, There is no need for Highlight.js, 
     so Huxblog drops it officially.

     - https://github.com/blog/2100-github-pages-now-faster-and-simpler-with-jekyll-3-0  
     - https://help.github.com/articles/creating-and-highlighting-code-blocks/    
-->
<!--
    <script>
        async("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js", function(){
            hljs.initHighlightingOnLoad();
        })
    </script>
    <link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet">
-->


<!-- jquery.tagcloud.js -->
<script>
    // only load tagcloud.js in tag.html
    if($('#tag_cloud').length !== 0){
        async("https://minwan1.github.io/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                //size: {start: 1, end: 1, unit: 'em'},
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>

<!--fastClick.js -->
<script>
    async("https://cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>


<!-- Google Analytics -->


<script>
    // dynamic User by Hux
    var _gaId = 'UA-XXXXXXXX-X';
    var _gaDomain = 'yoursite';

    // Originial
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', _gaId, _gaDomain);
    ga('send', 'pageview');
</script>




<!-- Baidu Tongji -->






	<a id="rocket" href="#top" class=""></a>
	<script type="text/javascript" src="/js/totop.js?v=1.0.0" async=""></script>
    <script type="text/javascript" src="/js/toc.js?v=1.0.0" async=""></script>
<!-- Image to hack wechat -->
<img src="https://minwan1.github.io/img/icon_wechat.png" width="0" height="0" />
<!-- Migrate from head to bottom, no longer block render and still work -->

</body>

</html>
