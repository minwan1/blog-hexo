<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="WanBlog | 개발블로그">
    <meta name="keyword"  content="WanBlog | 개발블로그">
    <meta name="naver-site-verification" content="c80ae88a487472e88ec9170ad53578e81edad8b1"/>

    <meta property="og:type" content="article">
	  <meta property="og:title" content="Wan Blog">
	  <meta property="og:url" content="https://minwan1.github.io/img/ironman-draw.png">
	  <meta property="og:site_name" content="JavaScript/Java/Spring 개발 Blog">
	  <meta property="og:description" content="WanBlog | 개발블로그">
	  <meta property="og:image" content="https://minwan1.github.io/img/ironman-draw.png">
	  <meta property="og:updated_time" content="2017-11-26T10:28:42.000Z">
    
    <link rel="shortcut icon" href="/img/ironman-draw.png">
    <!-- Place this tag in your head or just before your close body tag. -->
    <script async defer src="https://buttons.github.io/buttons.js"></script>
    <title>
        
          온라인 서점 API 만들기로 살펴보는 Spring Boot OOP 6 - WanBlog | 개발블로그
        
    </title>

    <link rel="canonical" href="https://minwan1.github.io/2018/08/26/2018-08-26-spring-book-6/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/beantech.min.css">

    <!-- Pygments Highlight CSS -->
    <link rel="stylesheet" href="/css/highlight.css">

    <link rel="stylesheet" href="/css/widget.css">

    <link rel="stylesheet" href="/css/rocket.css">

    <link rel="stylesheet" href="/css/signature.css">

    <link rel="stylesheet" href="/css/toc.css">

    <!-- Custom Fonts -->
    <!-- <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
    <!-- Hux change font-awesome CDN to qiniu -->
    <link href="https://cdn.staticfile.org/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">


    <!-- Hux Delete, sad but pending in China
    <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/
    css'>
    -->


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- ga & ba script hoook -->
    <script></script>
</head>


<!-- hack iOS CSS :active style -->
<body ontouchstart="">
	<!-- Modified by Yu-Hsuan Yen -->
<!-- Post Header -->
<style type="text/css">
    header.intro-header{
        
            background-image: url('null')
            /*post*/
        
    }
    
    #signature{
        background-image: url('/img/signature/BeanTechSign-white.png');
    }
    
</style>

<header class="intro-header" >
    <!-- Signature -->
    <div id="signature">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                
                    <div class="post-heading">
                        <div class="tags">
                            
                              <a class="tag" href="/tags/#Spring" title="Spring">Spring</a>
                            
                              <a class="tag" href="/tags/#Java" title="Java">Java</a>
                            
                              <a class="tag" href="/tags/#온라인 서점 API 만들기로 살펴보는 Spring Boot OOP" title="온라인 서점 API 만들기로 살펴보는 Spring Boot OOP">온라인 서점 API 만들기로 살펴보는 Spring Boot OOP</a>
                            
                        </div>
                        <h1>온라인 서점 API 만들기로 살펴보는 Spring Boot OOP 6</h1>
                        <h2 class="subheading">테스트 코드 작성하기</h2>
                        <span class="meta">
                            Posted by Wan on
                            2018-08-26
                        </span>
                    </div>
                


                </div>
            </div>
        </div>
    </div>
</header>

	
    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Wan Blog</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <!-- Known Issue, found by Hux:
            <nav>'s height woule be hold on by its content.
            so, when navbar scale out, the <nav> will cover tags.
            also mask any touch event of tags, unfortunately.
        -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>

                    

                        
                    

                        
                        <li>
                            <a href="/about/">About</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/archive/">Archives</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/tags/">Tags</a>
                        </li>
                        
                    
                    
                </ul>
            </div>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>
<script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        // CLOSE
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        // OPEN
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>


    <!-- Main Content -->
    <!-- Modify by Yu-Hsuan Yen -->

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

            <!-- Post Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                <h1><span id="step-05-테스트-코드-작성하기">Step-05 : 테스트 코드 작성하기</span></h1>
<h1><span id="목차">목차</span></h1>
<ul>
<li><a href="#1-%ED%85%8C%EC%8A%A4%ED%8A%B8-%EC%BD%94%EB%93%9C%EC%9D%98-%ED%95%84%EC%9A%94%EC%84%B1">1. 테스트 코드의 필요성</a></li>
<li><a href="#2-test-code-%EC%9E%91%EC%84%B1-%EB%B0%A9%EB%B2%95">2. Test code 작성 방법</a>
<ul>
<li><a href="#junit">Junit</a></li>
<li><a href="#mockito">Mockito</a></li>
</ul>
</li>
<li><a href="#3-unit-test%EB%8B%A8%EC%9C%84-%ED%85%8C%EC%8A%A4%ED%8A%B8">3. Unit Test(단위 테스트)</a>
<ul>
<li><a href="#%EC%BB%A8%ED%8A%B8%EB%A1%A4%EB%9F%AC-%ED%85%8C%EC%8A%A4%ED%8A%B8%EC%98%88%EC%A0%9C">컨트롤러 테스트(예제)</a></li>
<li><a href="#%EC%84%9C%EB%B9%84%EC%8A%A4-%ED%85%8C%EC%8A%A4%ED%8A%B8%EC%98%88%EC%A0%9C">서비스 테스트(예제)</a></li>
</ul>
</li>
<li><a href="#4-integration-test%ED%86%B5%ED%95%A9-%ED%85%8C%EC%8A%A4%ED%8A%B8">4. Integration Test(통합 테스트)</a>
<ul>
<li><a href="#%ED%86%B5%ED%95%A9%ED%85%8C%EC%8A%A4%ED%8A%B8-%EC%98%88%EC%A0%9C">통합테스트 예제</a>
<ul>
<li><a href="#runwithspringrunnerclass">@RunWith(SpringRunner.class)</a></li>
<li><a href="#springboottest">@SpringBootTest</a></li>
<li><a href="#mockmvc-%EC%82%AC%EC%9A%A9%ED%95%98%EA%B8%B0">MockMvc 사용하기</a></li>
</ul>
</li>
<li><a href="#tdd">TDD</a></li>
</ul>
</li>
<li><a href="#5-%EB%A7%88%EB%AC%B4%EB%A6%AC%ED%95%98%EB%A9%B0">5. 마무리하며</a></li>
</ul>
<!-- /TOC -->
<h1><span id="테스트-코드의-필요성">테스트 코드의 필요성</span></h1>
<p>회원가입 기능을 완성했지만 기능을 테스트하기 위해서는 Postman이나 Swagger로 테스트를 하거나 프론트엔드 화면을 구성해서 테스트를 해야 합니다. 기능 테스트 하나를 해야 하더라도 Postman, Swagger, 프런론 엔드 구성을 해야 한다면 너무 불편할 것입니다. 하지만 테스트코드를 가지고 있다면 아주 간단하게 기능을 테스트해볼 수 있습니다. 이외에도 아래와 같은 장점들이 있습니다.</p>
<ul>
<li>단위 테스트로 개발한다면 스프링이 실행될 때까지 기다리지 않아도 되니까 생산성이 올라간다.</li>
<li>테스트 코드가 있기 때문에 리팩토링을 할 때 자신감 있게 리펙토링이 가능해진다.</li>
<li>특정 기능을 리팩토링 한 후 그 기능과 관련된 테스트 코드들이 있으면 사전에 사이드 이펙트들을 방지할 수 있다.</li>
<li>테스트 코드를 작성하다 보면 이상하게 테스트 코드를 작성하기가 어려운 경우가 있는데 이것은 해당 기능 이상의 기능을 하고 있을 수 있다는 것을 의미한다. 이 부분을 개선해 나간다면 Decouple된 시스템을 갖게 된다.</li>
<li>실제 서비스에 배포되기 전에 테스트 코드들을 통해 기능들을 자동 테스트할 수 있다.</li>
<li>테스트 코드를 작성한다면 사전에 생각하지 못한 논리적인 오류들을 생각할 수 있다.</li>
</ul>
<h1><span id="test-code-작성-방법">Test code 작성 방법</span></h1>
<p>테스트 코드를 작성하기 위해서는 Junit 테스팅 프레임워크와 Mockito 목 프레임워크를 이용해 테스트 코드를 작성할 것입니다. 테스트 방법은 단위 테스트와 통합 테스트 두 방법으로 나누어 테스트 코드를 작성할 것입니다.<br>
여기에서 단위 테스트는 퍼블릭 메서드 기능 하나를 기준으로 테스트합니다. 통합 테스트는 컨트롤러 - 서비스 - 리파지토리 영역까지 테스트를 기준으로 테스트합니다. 먼저는 Junit부터 간단히 알아보겠습니다.</p>
<h2><span id="junit">Junit</span></h2>
<p>JUnit은 테스팅 프레임워크입니다. 외부에 의존 없이 자바 코드만으로 테스트를 가능하게 해주는 프레임워크입니다.</p>
<h2><span id="mockito">Mockito</span></h2>
<p>Mockito는 자바에서 테스트를 하기 위해 Mock을 만들어주는 프레임워크입니다. Mockito은 우리가 테스트하는 과정에서 이메일이 나가지 않거나 데이터베이스와 같은 외부 시스템 데이터베이스 연결에 의존하지 않게 해주는 아주 유용한 프레임워크입니다.<br>
또한 Mockito는 given, when, then 절로 테스트 코드를 좀 더 직관적으로 작성할 수 있습니다. 먼저 Junit과 Mockito를 이용해 단위테스트부터 작성해보겠습니다.</p>
<h1><span id="unit-test단위-테스트">Unit Test(단위 테스트)</span></h1>
<p>단위 테스트는 테스트하고자 하는 가장 작은 기능 단위로 테스트하는 기법을 말합니다. 단위 테스트 코드를 작성하는 이유는 가장 빠르게 최소 단위의 기능을 간단하게 테스트해볼 수 있고 정확하게 동작하는지 알 수 있습니다.</p>
<p>또한 해당 클래스의 책임또는 기능의 단위를 잡아주는 좋은 기준이 됩니다. 테스트 코드를 작성하다 보면 이상하게 테스트 코드를 작성하기가 어려운 경우가 있습니다. 이것은 해당 기능의 책임 이상의 기능을 하고 있을 가망성이 큽니다. 그렇기 때문에 새로운 디자인을 생각하게 해줍니다.</p>
<p>저는 개인적으로 단위 테스트는 크게 서비스 영역과 컨트롤러 영역 두개로 나눠서 테스트를 합니다. 먼저 컨트롤러 테스트 코드를 작성하겠습니다.</p>
<h2><span id="컨트롤러-테스트예제">컨트롤러 테스트(예제)</span></h2>
<p>단위 테스트에서는 스프링에 모든 빈들을 올릴 필요가 없습니다. 테스트하고자 하는 빈 만 등록하게 되면 훨씬 더 빠르게 테스트할 수 있습니다. 만약 기능 테스트 하나를 위해서 애플리케이션 빈들을 다 올리게 되면 엄청난 시간 낭비 일 것입니다.</p>
<p>아래 소스는 테스트 코드를 작성하기 위해 설정하는 값에 대한 간단한 설명입니다.</p>
<ol>
<li>@RunWith(MockitoJUnitRunner.class)은 주어진 mock 객체들을 초기화하는 역할을 합니다.</li>
<li>테스트할 때 필요로 하는 Mock 객체들을 등록해줍니다.</li>
<li>테스트하고자 하는 클래스에 @InjectMocks을 넣어주면 Mock 객체들이 해당 클래스에 주입됩니다.</li>
<li>컨트롤러 객체를 전달받아 MockMvc 객체를 생성하며, 다른 스프링 빈을 올릴 필요 없이 해당 컨트롤러만 테스트 가능합니다.</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@RunWith</span>(MockitoJUnitRunner.class) <span class="comment">//1</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MemberControllerTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Mock</span></span><br><span class="line">    <span class="keyword">private</span> MemberHelperService memberHelperService;<span class="comment">//2</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@InjectMocks</span></span><br><span class="line">    <span class="keyword">private</span> MemberController memberController; <span class="comment">//3</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUp</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        mockMvc = MockMvcBuilders <span class="comment">//4</span></span><br><span class="line">                .standaloneSetup(memberController)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>그리고 다음은 Member 컨틀롤러를 테스트하기 위한 테스트 코드입니다. 개인적으로 테스트하기 위해서 given, when, then을 정하고 순서에 맞게 작성하는 편입니다.</p>
<table>
<thead>
<tr>
<th>구분</th>
<th>설명</th>
</tr>
</thead>
<tbody>
<tr>
<td>given</td>
<td>목데이터 또는 Request 값들을 설정합니다.</td>
</tr>
<tr>
<td>when</td>
<td>실제 테스트 하고자하는 기능을 실행합니다.</td>
</tr>
<tr>
<td>then</td>
<td>테스트한 결과값이 의도한값이 맞는지 검증합니다.</td>
</tr>
</tbody>
</table>
<p>간단하게 아래 테스트 코드를 설명해드리겠습니다.</p>
<ol>
<li>회원가입을 위해 RequestBody 값을 만든다.</li>
<li>컨트롤러 쪽에서 memberSignUpService를 호출할 때 Mock 데이터인 request.toMember() 값을 리턴해주는 코드입니다.</li>
<li>실제 MemberController에 /members POST를 호출하고 결과 값을 받습니다.</li>
<li>받은 값을 Mapper를 이용해 Member 클래스로 역 직렬화를 합니다.</li>
<li>리턴 값이 의도한 값이 맞는지 확인합니다.</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">private</span> String TEST_EMAIL = <span class="string">"test@test.com"</span>;</span><br><span class="line"><span class="keyword">private</span> String TEST_PASSWORD = <span class="string">"password"</span>;</span><br><span class="line"><span class="keyword">private</span> String TEST_FIRST_NAME = <span class="string">"test"</span>;</span><br><span class="line"><span class="keyword">private</span> String TEST_LAST_NAME = <span class="string">"test"</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">signUpMember_SignupIsSuccess_Member</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//given</span></span><br><span class="line">    <span class="keyword">final</span> MemberSignupRequest request = buildSignupRequest(TEST_EMAIL, TEST_PASSWORD, TEST_FIRST_NAME, TEST_LAST_NAME); <span class="comment">//1</span></span><br><span class="line">    given(memberSignUpService.signUp(any())).willReturn(request.toMember()); <span class="comment">//2</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//when</span></span><br><span class="line">    <span class="keyword">final</span> String memberAsString = mockMvc.perform(</span><br><span class="line">            post(<span class="string">"/members"</span>)</span><br><span class="line">                    .contentType(MediaType.APPLICATION_JSON)</span><br><span class="line">                    .content(mapper.writeValueAsString(request)))</span><br><span class="line">            .andDo(print())</span><br><span class="line">            .andExpect(status().isCreated())</span><br><span class="line">            .andReturn()</span><br><span class="line">            .getResponse()</span><br><span class="line">            .getContentAsString();<span class="comment">//3</span></span><br><span class="line">    <span class="keyword">final</span> Member member = mapper.readValue(memberAsString, Member.class); <span class="comment">//4</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//then</span></span><br><span class="line">    Assert.assertThat(request.getEmail(), equalTo(member.getEmail())); <span class="comment">//5</span></span><br><span class="line">    Assert.assertThat(request.getName(), equalTo(member.getName()));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> MemberSignupRequest <span class="title">buildSignupRequest</span><span class="params">(<span class="keyword">final</span> String email, <span class="keyword">final</span> String password, <span class="keyword">final</span> String firstname, <span class="keyword">final</span> String lastname)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> MemberSignupRequest.builder()</span><br><span class="line">            .email(<span class="keyword">new</span> Email(email))</span><br><span class="line">            .password(<span class="keyword">new</span> Password(password))</span><br><span class="line">            .name(<span class="keyword">new</span> Name(firstname, lastname))</span><br><span class="line">            .build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>5번 목록을 보면 굳이 Member 클래스로 역질렬화하여 assertThat로 검증을 할 필요 없이 JsonPath() 기능을 이용해서 검증할 수 있지만 개인적으로는 String으로 테스트 코드들을 관리해야 한다는 점 때문에 클래스로 변경하여 데이터를 검증하는 편입니다.</p>
<p>Email이나 Name 이 같은 value 인지 체크하기 위해서는 Equals메소드를 재정의 해줘야 합니다. 그래야 같은 벨류값인지 비교를할 수 있습니다. 이러한 이유는 <a href="https://minwan1.github.io/2018/07/03/2018-07-03-equals,hashcode/">여기</a>를 참조해주시면 감사하겠습니다.<br>
<a href="https://github.com/minwan1/online-book-store/blob/master/src/test/java/com/book/member/MemberControllerTest.java" target="_blank" rel="noopener">Controller Test code</a></p>
<h2><span id="서비스-테스트예제">서비스 테스트(예제)</span></h2>
<p>다음은 서비스 코드 단위 테스트 예제입니다. 여기에서는 서비스에 회원가입에 대한 로직만 정확하게 테스트하면 됩니다. 테스트 코드 작성 순서는 다음과 같습니다.</p>
<ol>
<li>memberSignUpService.signUp() 넘어올 예상되는 파라미터 값을 만듭니다.</li>
<li>Mockito 프레임워크를 이용해 repository를 이용해 저장한 후 디비에서 리턴해줄 값을 작성합니다.</li>
<li>실제 memberSignUpService.signUp() 호출합니다.</li>
<li>실제로 memberSignUpService.signUp() 기능이 호출돼서 서비스의 비즈니스 로직이 제대로 진행돼서 memberRepository.save가 호출되었는지 확인합니다.</li>
<li>memberSignUpService.signUp()로 처리된 이메일과 예상되는 이메일이 맞는지 확인합니다.</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">signUp_SignUpIsSuccess_Member</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//given</span></span><br><span class="line">    <span class="keyword">final</span> MemberSignupRequest request = buildRequest(TEST_EMAIL); <span class="comment">//1</span></span><br><span class="line">    given(memberRepository.save(any(Member.class))).willReturn(request.toMember()); <span class="comment">//2</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//when</span></span><br><span class="line">    <span class="keyword">final</span> Member member = memberSignUpService.signUp(request); <span class="comment">//3</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//then </span></span><br><span class="line">    Mockito.verify(memberRepository, atLeast(<span class="number">1</span>)).save(any(Member.class)); <span class="comment">//4</span></span><br><span class="line">    Assert.assertThat(member.getEmail(), is(request.getEmail()));<span class="comment">//5</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a href="https://github.com/minwan1/online-book-store/blob/master/src/test/java/com/book/member/service/MemberSignUpServiceTest.java" target="_blank" rel="noopener">Service Test code</a></p>
<h1><span id="4-integration-test통합-테스트">4. Integration Test(통합 테스트)</span></h1>
<p>통합 테스트는 단위 테스트보다는 덜 빈번하게 실행되면서 세세한 API 수준의 검증보다는 모듈 단위의 상호 연동이 문제가 없는지 검증하는 것이 주 목적입니다. 위에서 각각의 모듈 별로 단위 테스트를 성공했음에도 이것들을 하나로 결합해서 테스트를 하는 과정에서 테스트가 실패할 수도 있습니다. 예를 들어 데이터베이스 제약조건 등에 문제, 다른 클래스에 의존하고 있는 클래스들이 제대로 연결되었는지 등이 예일 수 있습니다.</p>
<h2><span id="통합테스트-예제">통합테스트 예제</span></h2>
<p>다음은 단위 테스트와 다르게 아래의 두 개의 어노테이션을 붙여주셔야 합니다. 위에 단위 테스트는 해당 클래스 하나만 테스트하면 됐지만 통합 테스트 같은 경우 테스트하고자 하는 모듈들이 모두 연결되어 있어야 하기 때문에 애플리케이션에 모든 빈들을 등록해서 테스트합니다.</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RunWith</span>(SpringRunner.class)</span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MemberControllerIntegrationTest</span> </span>&#123;</span><br></pre></td></tr></table></figure>
<h3><span id="runwithspringrunnerclass">@RunWith(SpringRunner.class)</span></h3>
<p>SpringJUnit4ClassRunner를 상속받은 SpringRunner 클래스는 SpringBootTest 의 설정돼있는 정보들을 이용해서 스프링 컨테이너를 생성한다. 그리고 Test 클래스에 있는 필드에 있는 변수들에 맞는 클래스를 의존성 주입을 해준다.</p>
<h3><span id="springboottest">@SpringBootTest</span></h3>
<p>@SpringBootTest은 프로젝트에 어플리케이션빈들은 등록해주는 역할을 한다. 반드시 위에 @RunWith(SpringRunner.class)과 같이 사용해줘야 한다.</p>
<h3><span id="mockmvc-사용하기">MockMvc 사용하기</span></h3>
<p>아래의 소스와 같이 단위 테스트와 달리 스프링 웹 애플리케이션을 빈을 주입받고 그것을 기반으로 MockMvc를 만들어줘야 합니다. 이렇게 설정을 하고 실제 API를 호출하게 되면 각 레이어들이 연결된 기능을 테스트해볼 수 있습니다.</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> WebApplicationContext webApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Before</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUp</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    mockMvc = MockMvcBuilders.webAppContextSetup(webApplicationContext)</span><br><span class="line">            .build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Mvc 설정을 했으면 이제 실제 테스트 코드를 작성해야 합니다. 순서를 설명해드리면 다음과 같습니다.</p>
<ol>
<li>회원가입 API를 호출하면 데이터베이스 회원정보가 insert 될 것 입니다. 하지만 test 코드에서 @Transactional 붙이면 테스트코드 실행 후 insert 됐던 데이터가가 롤백이 됩니다.</li>
<li>회원가입을 하기 위해 필요한 RequestBody 값을 만든다.</li>
<li>실제 회원가입 URL을 호출한다.</li>
<li>결과값을 Member 클래스로 변경한다.</li>
<li>결과값이 테스트 의도한값이 맞는지 확인한다.</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@Transactional</span><span class="comment">//1</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">signUpMember_SignupIsSuccess_Member</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//given</span></span><br><span class="line">    <span class="keyword">final</span> MemberSignupRequest request = buildSignupRequest(TEST_EMAIL, TEST_PASSWORD, TEST_FIRST_NAME, TEST_LAST_NAME); <span class="comment">//2</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//when</span></span><br><span class="line">    <span class="keyword">final</span> String memberAsString = mockMvc.perform(</span><br><span class="line">            post(<span class="string">"/members"</span>)</span><br><span class="line">                    .contentType(MediaType.APPLICATION_JSON)</span><br><span class="line">                    .content(mapper.writeValueAsString(request)))</span><br><span class="line">            .andDo(print())</span><br><span class="line">            .andExpect(status().isCreated())</span><br><span class="line">            .andReturn()</span><br><span class="line">            .getResponse()</span><br><span class="line">            .getContentAsString(); <span class="comment">//3</span></span><br><span class="line">    <span class="keyword">final</span> Member member = mapper.readValue(memberAsString, Member.class); <span class="comment">//4</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//then</span></span><br><span class="line">    Assert.assertThat(request.getEmail(), is(member.getEmail()));<span class="comment">//5</span></span><br><span class="line">    Assert.assertThat(request.getName(), is(member.getName()));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> MemberSignupRequest <span class="title">buildSignupRequest</span><span class="params">(<span class="keyword">final</span> String email, <span class="keyword">final</span> String password, <span class="keyword">final</span> String firstname, <span class="keyword">final</span> String lastname)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> MemberSignupRequest.builder()</span><br><span class="line">            .email(<span class="keyword">new</span> Email(email))</span><br><span class="line">            .password(<span class="keyword">new</span> Password(password))</span><br><span class="line">            .name(<span class="keyword">new</span> Name(firstname, lastname))</span><br><span class="line">            .build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a href="https://github.com/minwan1/online-book-store/blob/master/src/test/java/com/book/member/MemberControllerIntegrationTest.java" target="_blank" rel="noopener">Integration Test code</a></p>
<h2><span id="tdd">TDD</span></h2>
<p>TDD란 테스트 코드를 먼저 작성하고 기능을 구현하고 또 이것을 리팩 토핑 하고 이것을 반복해서 기능을 만드는 개발 방법론을 말합니다. 테스트 주도 개발을 하게 되면 장점은 테스트 코드 하기 좋은 코드를 만들게 된다는 것입니다. 테스트 코드가 작성하기 좋은 코드의 의미는 해당 메서드나 클래스가 하나의 기능 혹은 책임만을 하고 있다는 것을 의미합니다. 이렇듯 테스트 주도 개발을 하게 되면 자연스럽게 Decouple된 객체지향 설계를 할 수 있게 되고 자연스럽게 테스트 코드들을 얻을 수 있습니다. 그렇게 되면 처음에 말했던 테스트 코드의 장점들을 얻게 됩니다.</p>
<h1><span id="5-마무리하며">5. 마무리하며</span></h1>
<p>회원가입에 관련된 테스트 코드들을 완성했습니다. 이제 회원가입의 기능을 테스트를 하기 위해서 Swagger나 프론트엔드 화면이 필요하지 않습니다. 테스트 코드들로 테스트가 가능하기 때문입니다. 또한 테스트 코드는 좋은 문서또는 커뮤니케이션 도구가 될 수 있습니다. 예를 들어 다른 개발자가 SMS 인증 기능이 필요해서 SMS 인증 기능을 만든 개발자한테 기능을 요구했으면 SMS 기능 개발자는 단순 문서나 설명만 해주기보다는 테스트 코드를 준다면 좀 더 효율적으로 커뮤니케이션을 할 수 있을것입니다.</p>
<p>참고</p>
<ul>
<li><a href="https://www.youtube.com/watch?v=60lLSe1phks&amp;list=PLuLb6MC4SOvXCRePHrb4e-EYadjZ9KHyH" target="_blank" rel="noopener">백명석님 강의</a></li>
</ul>

                

                <hr>
                <!-- Pager -->
                <ul class="pager">
                    
                        <li class="previous">
                            <a href="/2018/09/23/2018-09-03-java-reg/" data-toggle="tooltip" data-placement="top" title="정규식이란 ? - Java">&larr; Previous Post</a>
                        </li>
                    
                    
                        <li class="next">
                            <a href="/2018/08/01/2018-07-26-spring-book-5/" data-toggle="tooltip" data-placement="top" title="온라인 서점 API 만들기로 살펴보는 Spring Boot OOP 5">Next Post &rarr;</a>
                        </li>
                    
                </ul>

                <!-- duoshuo Share start -->
                
                <!-- 多说 Share end-->

                <!-- 多说评论框 start -->
                
                <!-- 多说评论框 end -->

                <!-- disqus comment start -->
                
                    <div class="comment">
                        <div id="disqus_thread" class="disqus-thread"></div>
                    </div>
                
                <!-- disqus comment end -->
            </div>
            
            <!-- Tabe of Content -->
            <!-- Table of Contents -->

    
      <aside id="sidebar">
        <div id="toc" class="toc-article">
        <strong class="toc-title">Contents</strong>
        
          <ol class="toc-nav"><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">1.</span> <span class="toc-nav-text">Step-05 : 테스트 코드 작성하기</span></a></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">2.</span> <span class="toc-nav-text">목차</span></a></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">3.</span> <span class="toc-nav-text">테스트 코드의 필요성</span></a></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">4.</span> <span class="toc-nav-text">Test code 작성 방법</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">4.1.</span> <span class="toc-nav-text">Junit</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">4.2.</span> <span class="toc-nav-text">Mockito</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">5.</span> <span class="toc-nav-text">Unit Test(단위 테스트)</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">5.1.</span> <span class="toc-nav-text">컨트롤러 테스트(예제)</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">5.2.</span> <span class="toc-nav-text">서비스 테스트(예제)</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">6.</span> <span class="toc-nav-text">4. Integration Test(통합 테스트)</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">6.1.</span> <span class="toc-nav-text">통합테스트 예제</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">6.1.1.</span> <span class="toc-nav-text">@RunWith(SpringRunner.class)</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">6.1.2.</span> <span class="toc-nav-text">@SpringBootTest</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">6.1.3.</span> <span class="toc-nav-text">MockMvc 사용하기</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">6.2.</span> <span class="toc-nav-text">TDD</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">7.</span> <span class="toc-nav-text">5. 마무리하며</span></a></li></ol>
        
        </div>
      </aside>
    

                
            <!-- Sidebar Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                
                <section>
                    <!-- no hr -->
                    <h5><a href="/tags/">FEATURED TAGS</a></h5>
                    <div class="tags">
                       
                          <a class="tag" href="/tags/#Spring" title="Spring">Spring</a>
                        
                          <a class="tag" href="/tags/#Java" title="Java">Java</a>
                        
                          <a class="tag" href="/tags/#온라인 서점 API 만들기로 살펴보는 Spring Boot OOP" title="온라인 서점 API 만들기로 살펴보는 Spring Boot OOP">온라인 서점 API 만들기로 살펴보는 Spring Boot OOP</a>
                        
                    </div>
                </section>
                

                <!-- Friends Blog -->
                
                <hr>
                <h5>FRIENDS</h5>
                <ul class="list-inline">

                    
                </ul>
                
            </div>
        </div>
    </div>
</article>




<!-- disqus embedded js code start (one page only need to embed once) -->
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = "https-minwan1-github-io";
    var disqus_identifier = "https://minwan1.github.io/2018/08/26/2018-08-26-spring-book-6/";
    var disqus_url = "https://minwan1.github.io/2018/08/26/2018-08-26-spring-book-6/";

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<!-- disqus embedded js code start end -->




<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>
<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<script>
    async("https://cdn.bootcss.com/anchor-js/1.1.1/anchor.min.js",function(){
        anchors.options = {
          visible: 'hover',
          placement: 'left',
          icon: 'ℬ'
        };
        anchors.add().remove('.intro-header h1').remove('.subheading').remove('.sidebar-container h5');
    })
</script>
<style>
    /* place left on bigger screen */
    @media all and (min-width: 800px) {
        .anchorjs-link{
            position: absolute;
            left: -0.75em;
            font-size: 1.1em;
            margin-top : -0.1em;
        }
    }
</style>



    <!-- Footer -->
    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                
                
                

                

                

                
                    <li>
                        <a target="_blank"  href="https://github.com/Minwan1">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                

                </ul>
                <p class="copyright text-muted">
                    Copyright &copy; Wan 2019 
                    <br>
                    Theme by <a href="http://huangxuan.me">Hux</a> 
                    <span style="display: inline-block; margin: 0 5px;">
                        <i class="fa fa-heart"></i>
                    </span> 
                    re-Ported by <a href="http://beantech.org">BeanTech</a> | 
                    <iframe
                        style="margin-left: 2px; margin-bottom:-5px;"
                        frameborder="0" scrolling="0" width="91px" height="20px"
                        src="https://ghbtns.com/github-btn.html?user=YenYuHsuan&repo=hexo-theme-beantech&type=star&count=true" >
                    </iframe>
                </p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js"></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js"></script>

<!-- Custom Theme JavaScript -->
<script src="/js/hux-blog.min.js"></script>


<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>

<!-- 
     Because of the native support for backtick-style fenced code blocks 
     right within the Markdown is landed in Github Pages, 
     From V1.6, There is no need for Highlight.js, 
     so Huxblog drops it officially.

     - https://github.com/blog/2100-github-pages-now-faster-and-simpler-with-jekyll-3-0  
     - https://help.github.com/articles/creating-and-highlighting-code-blocks/    
-->
<!--
    <script>
        async("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js", function(){
            hljs.initHighlightingOnLoad();
        })
    </script>
    <link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet">
-->


<!-- jquery.tagcloud.js -->
<script>
    // only load tagcloud.js in tag.html
    if($('#tag_cloud').length !== 0){
        async("https://minwan1.github.io/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                //size: {start: 1, end: 1, unit: 'em'},
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>

<!--fastClick.js -->
<script>
    async("https://cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>


<!-- Google Analytics -->


<script>
    // dynamic User by Hux
    var _gaId = 'UA-XXXXXXXX-X';
    var _gaDomain = 'yoursite';

    // Originial
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', _gaId, _gaDomain);
    ga('send', 'pageview');
</script>




<!-- Baidu Tongji -->






	<a id="rocket" href="#top" class=""></a>
	<script type="text/javascript" src="/js/totop.js?v=1.0.0" async=""></script>
    <script type="text/javascript" src="/js/toc.js?v=1.0.0" async=""></script>
<!-- Image to hack wechat -->
<img src="https://minwan1.github.io/img/icon_wechat.png" width="0" height="0" />
<!-- Migrate from head to bottom, no longer block render and still work -->

</body>

</html>
